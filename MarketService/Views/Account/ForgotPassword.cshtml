@{
    ViewData["Title"] = "Qu√™n m·∫≠t kh·∫©u";
}

@section Styles {
    <link rel="stylesheet" href="~/css/auth.css" asp-append-version="true" />
}

<div class="auth-page-wrapper">
    <div class="auth-card">
        <div class="auth-header">
            <span class="auth-logo-icon">üîí</span>
            <h1 class="auth-title">Qu√™n m·∫≠t kh·∫©u?</h1>
            <p class="auth-subtitle">Nh·∫≠p email c·ªßa b·∫°n ƒë·ªÉ b·∫Øt ƒë·∫ßu qu√° tr√¨nh kh√¥i ph·ª•c</p>
        </div>
        
        <form id="forgotForm" onsubmit="handleForgot(event)">
            <div class="form-group">
                <label for="email">Email kh√¥i ph·ª•c</label>
                <input type="email" id="email" name="email" required class="form-input" placeholder="example@email.com">
            </div>

            <div id="forgotMessage" class="success-message"></div>
            <div id="forgotError" class="error-message"></div>
            
            <button type="submit" class="btn btn-primary btn-full">G·ª≠i y√™u c·∫ßu</button>
        </form>
        
        <div class="auth-footer">
            <p>
                Nh·ªõ ra m·∫≠t kh·∫©u? <a href="/Account/Login">Quay l·∫°i ƒëƒÉng nh·∫≠p</a>
            </p>
        </div>
    </div>
</div>

@section Scripts {
<script>
    async function handleForgot(e) {
        e.preventDefault();
        const messageDiv = document.getElementById('forgotMessage');
        const errorDiv = document.getElementById('forgotError');
        const submitBtn = e.target.querySelector('button[type="submit"]');
        
        messageDiv.textContent = '';
        errorDiv.textContent = '';
        submitBtn.disabled = true;
        submitBtn.textContent = 'ƒêang g·ª≠i...';
        
        const email = document.getElementById('email').value;
        
        try {
            const res = await fetch('/api/auth/forgot-password', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email })
            });
            
            const data = await res.json();
            
            if (res.ok) {
                messageDiv.textContent = data.message;
                // Since we are mocking email sending, the message contains the token link in DEBUG mode
            } else {
                errorDiv.textContent = data.message || 'G·ª≠i y√™u c·∫ßu th·∫•t b·∫°i';
            }
        } catch (e) {
            errorDiv.textContent = 'L·ªói k·∫øt n·ªëi, vui l√≤ng th·ª≠ l·∫°i';
        } finally {
            submitBtn.disabled = false;
            submitBtn.textContent = 'G·ª≠i y√™u c·∫ßu';
        }
    }
</script>
}
