@model IEnumerable<MarketService.Models.ShippingOrder>

@{
    ViewData["Title"] = "Qu·∫£n l√Ω V·∫≠n chuy·ªÉn";
}

<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>üì¶ ƒê∆°n h√†ng v·∫≠n chuy·ªÉn</h1>
        <a asp-action="Addresses" class="btn btn-outline-primary">
            <i class="bi bi-geo-alt"></i> Qu·∫£n l√Ω ƒê·ªãa ch·ªâ
        </a>
    </div>

    @if (Model.Any())
    {
        <div class="card shadow-sm border-0">
            <div class="table-responsive">
                <table class="table table-hover mb-0 align-middle">
                    <thead class="table-light">
                        <tr>
                            <th>M√£ v·∫≠n ƒë∆°n</th>
                            <th>ƒê∆°n v·ªã</th>
                            <th>S·∫£n ph·∫©m</th>
                            <th>Ph√≠ ship</th>
                            <th>Tr·∫°ng th√°i</th>
                            <th>C·∫≠p nh·∫≠t</th>
                            <th>Thao t√°c</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var order in Model)
                        {
                            <tr>
                                <td class="fw-bold text-primary">@order.TrackingNumber</td>
                                <td>@order.Provider</td>
                                <td>
                                    <a href="/Market/Details/@order.ProductId" class="text-decoration-none fw-600">
                                        <i class="bi bi-box-seam me-1"></i> #@order.ProductId
                                    </a>
                                </td>
                                <td>@order.ShippingFee.ToString("N0") ƒë</td>
                                <td>
                                    <span class="badge bg-info text-dark">@order.Status</span>
                                </td>
                                <td class="small text-muted">
                                    @(order.EstimatedDelivery?.ToString("dd/MM/yyyy") ?? "N/A")
                                </td>
                                <td>
                                    <button class="btn btn-sm btn-outline-secondary" onclick="trackOrder('@order.TrackingNumber')">
                                        Tra c·ª©u
                                    </button>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    }
    else
    {
        <div class="text-center py-5 text-muted bg-white rounded shadow-sm">
            <i class="bi bi-box-seam fs-1 d-block mb-3"></i>
            <p>Ch∆∞a c√≥ ƒë∆°n h√†ng n√†o.</p>
        </div>
    }
</div>

@section Scripts {
    <script>
        async function trackOrder(code) {
            try {
                const res = await fetch(`/api/shipping/track/${code}`);
                if (res.ok) {
                    const data = await res.json();
                    alert(`Tr·∫°ng th√°i: ${data.status}\nV·ªã tr√≠: ${data.currentLocation}\nD·ª± ki·∫øn: ${new Date(data.estimatedDelivery).toLocaleDateString()}`);
                } else {
                    alert('Kh√¥ng t√¨m th·∫•y th√¥ng tin v·∫≠n ƒë∆°n');
                }
            } catch (e) {
                alert('L·ªói k·∫øt n·ªëi');
            }
        }
    </script>
}
